<!DOCTYPE html>
<html lang="tr">
<head>
    <meta id="theme-meta" name="theme-color" content="#230c40">
    <meta name="color-scheme" content="dark">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>orjnc tv+</title>
    <link rel="icon" type="image/png" href="logolar/logo.png">
    <link rel="apple-touch-icon" href="logolar/logo.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- ORIJINAL STIL AYARLARI --- */
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding-top: 70px;
            transition: background 0.3s ease;
        }

        body.normal-mode {
            background-color: #230c40;
        }

        /* HEADER & NAVBAR */
        .navbar-custom {
            height: 70px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 2000;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* STICKY PLAYER - BU KISIM TAMİR EDİLDİ */
        .video-wrapper {
            position: sticky !important;
            top: 70px !important;
            z-index: 1100 !important;
            background: #000 !important;
            width: 100%;
            overflow: hidden;
            aspect-ratio: 16 / 9;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .player-info-sticky {
            background-color: #000 !important;
            position: sticky !important;
            top: calc(70px + 56.25vw) !important; /* Dinamik video yüksekliği */
            z-index: 1090 !important;
            padding: 12px 20px;
            border-bottom: 2px solid #222;
        }

        body.normal-mode .player-info-sticky {
            background-color: #230c40 !important;
        }

        #suggested-container {
            margin-top: 25px !important;
            padding-bottom: 120px !important;
        }

        /* KART TASARIMLARI */
        .channel-card {
            background: #111;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: 0.3s;
            cursor: pointer;
            position: relative;
            border: 1px solid transparent;
            height: 100%;
        }

        .channel-card:hover {
            transform: translateY(-5px);
            border-color: #7000ff;
            background: #1a1a1a;
        }

        .channel-card img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        /* FAVORİ BUTONU */
        .fav-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #444;
            font-size: 1.2rem;
            transition: 0.3s;
            z-index: 5;
        }

        .fav-btn.active {
            color: #ff0055;
        }

        /* SIDEBAR */
        #sidebar {
            position: fixed;
            left: -280px;
            top: 0;
            width: 280px;
            height: 100%;
            background: #111;
            z-index: 3000;
            transition: 0.3s;
            padding: 20px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }

        #sidebar.active {
            left: 0;
        }

        #overlay {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2500;
            top: 0;
            left: 0;
        }

        /* PROMO ANİMASYONU */
        .promo-active {
            animation: pulseGlow 2s infinite;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px #7000ff; }
            50% { box-shadow: 0 0 18px #7000ff; }
            100% { box-shadow: 0 0 5px #7000ff; }
        }

        /* DİĞER ORIJINAL STİLLER */
        .cursor-pointer { cursor: pointer; }
        .text-purple { color: #a252ff; }
        .hover-bg:hover { background: rgba(255,255,255,0.1); }
    </style>
</head>
<body class="dark-mode">

    <div id="overlay" onclick="toggleSidebar()"></div>

    <div id="sidebar">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="text-purple m-0">Menü</h4>
            <i class="fas fa-times cursor-pointer" onclick="toggleSidebar()"></i>
        </div>
        <button class="btn btn-outline-light w-100 mb-3" onclick="toggleTheme()">
            <i class="fas fa-adjust me-2"></i> Tema Değiştir
        </button>
        <hr>
        <div id="sidebar-content">
            </div>
    </div>

    <nav class="navbar-custom justify-content-between">
        <div class="d-flex align-items-center">
            <i class="fas fa-bars me-3 fs-4 cursor-pointer" onclick="toggleSidebar()"></i>
            <img src="logolar/logo.png" height="40" alt="Logo" class="cursor-pointer" onclick="location.reload()">
        </div>
        
        <div class="mx-3 flex-grow-1 d-none d-md-block" style="max-width: 500px;">
            <div class="input-group">
                <span class="input-group-text bg-dark border-0 text-secondary"><i class="fas fa-search"></i></span>
                <input type="text" id="searchInput" class="form-control bg-dark text-white border-0" placeholder="Kanal veya kategori ara...">
            </div>
        </div>

        <div class="d-flex align-items-center">
            <div id="fav-count-badge" class="me-3 small text-secondary"></div>
            <i class="fas fa-moon fs-5 cursor-pointer" onclick="toggleTheme()"></i>
        </div>
    </nav>

    <main class="container-fluid">
        <div id="player-box" style="display: none;">
            <div id="sticky-player-header">
                <div class="video-wrapper">
                    <video id="video" controls autoplay playsinline></video>
                </div>
                <div class="player-info-sticky">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 id="now-playing" class="m-0 text-truncate">Kanal Adı</h5>
                            <p class="small mt-1 mb-0 opacity-75" id="player-cat-info">Canlı Yayın</p>
                        </div>
                        <button class="btn btn-sm btn-outline-danger border-0" onclick="closePlayer()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div id="suggested-container" class="px-2 mt-4">
                <h6 class="small fw-bold text-uppercase opacity-50 mb-3 ml-2">Sizin İçin Önerilenler</h6>
                <div id="suggested-list" class="row g-2"></div>
            </div>
        </div>

        <div id="main-content">
            <div id="featured-area" class="mt-3"></div>
            
            <div class="d-flex justify-content-between align-items-center mt-4 mb-2 px-2">
                <h5 id="grid-title" class="m-0 fw-bold">Tüm Kanallar</h5>
            </div>

            <div id="channel-grid" class="row g-3"></div>
        </div>
    </main>

    <script>
        /* --- ORIJINAL JS MANTIĞI VE TÜM FONKSİYONLAR --- */
        let allChannels = [];
        let favorites = JSON.parse(localStorage.getItem('myTVfavs')) || [];
        const hls = new Hls();

        // 1. Kategori Güvenliği (Orijinal Fonksiyon)
        function getSafeCategory(channel) {
            if (channel.kategori) return channel.kategori;
            const name = channel.ad.toLowerCase();
            if (name.includes('spor') || name.includes('beın')) return 'Spor';
            if (name.includes('haber')) return 'Haber';
            if (name.includes('belgesel')) return 'Belgesel';
            if (name.includes('çocuk') || name.includes('trt çocuk')) return 'Çocuk';
            return 'Genel';
        }

        // 2. Veri Yükleme
        fetch('kanallar.json')
            .then(response => response.json())
            .then(data => {
                allChannels = data;
                renderGrid(allChannels);
                renderSidebar();
                checkHash();
                updateFavBadge();
            })
            .catch(err => console.error("Kanal verisi yüklenemedi:", err));

        // 3. Grid Oluşturma (Tüm detaylar ve Favori mantığı)
        function renderGrid(list) {
            const grid = document.getElementById('channel-grid');
            grid.innerHTML = list.map(c => `
                <div class="col-6 col-md-4 col-lg-2">
                    <div class="channel-card" onclick="playChannel('${c.url}', '${c.ad}', true, '${getSafeCategory(c)}')">
                        <i class="fas fa-heart fav-btn ${favorites.includes(c.ad) ? 'active' : ''}" 
                           onclick="event.stopPropagation(); toggleFav('${c.ad}')"></i>
                        <img src="logolar/${c.ad}.png" onerror="this.src='logolar/default.png'" alt="${c.ad}">
                        <div class="small text-truncate fw-bold">${c.ad}</div>
                        <div style="font-size: 10px;" class="opacity-50">${getSafeCategory(c)}</div>
                    </div>
                </div>
            `).join('');
        }

        // 4. Kanal Oynatma (Sticky ve HLS mantığı)
        function playChannel(url, ad, scroll, kategori) {
            const playerBox = document.getElementById('player-box');
            const mainContent = document.getElementById('main-content');
            const video = document.getElementById('video');

            playerBox.style.display = 'block';
            mainContent.style.display = 'none';
            document.getElementById('now-playing').innerText = ad;
            document.getElementById('player-cat-info').innerText = "Canlı Yayın • " + kategori;

            if (Hls.isSupported()) {
                hls.loadSource(url);
                hls.attachMedia(video);
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = url;
            }

            window.location.hash = encodeURIComponent(ad);
            if (scroll) window.scrollTo({ top: 0, behavior: 'smooth' });
            
            renderSuggested(kategori, ad);
        }

        // 5. Önerilenler (Kategori Bazlı Orijinal Mantık)
        function renderSuggested(kategori, currentAd) {
            const suggested = allChannels.filter(c => getSafeCategory(c) === kategori && c.ad !== currentAd).slice(0, 12);
            const container = document.getElementById('suggested-list');
            
            if (suggested.length === 0) {
                container.innerHTML = '<div class="col-12 p-3 opacity-50 small">Bu kategori için başka öneri bulunamadı.</div>';
                return;
            }

            container.innerHTML = suggested.map(c => `
                <div class="col-6 col-md-4 col-lg-2">
                    <div class="channel-card py-2" onclick="playChannel('${c.url}', '${c.ad}', true, '${getSafeCategory(c)}')">
                        <img src="logolar/${c.ad}.png" style="height: 35px; width: 35px; margin-bottom: 5px;">
                        <div style="font-size: 11px;" class="text-truncate">${c.ad}</div>
                    </div>
                </div>
            `).join('');
        }

        // 6. Favori Sistemi
        function toggleFav(ad) {
            if (favorites.includes(ad)) {
                favorites = favorites.filter(f => f !== ad);
            } else {
                favorites.push(ad);
            }
            localStorage.setItem('myTVfavs', JSON.stringify(favorites));
            updateFavBadge();
            renderGrid(allChannels);
        }

        function updateFavBadge() {
            const badge = document.getElementById('fav-count-badge');
            if (badge) badge.innerText = favorites.length > 0 ? favorites.length + " Favori" : "";
        }

        // 7. Sidebar & Kategoriler
        function renderSidebar() {
            const sidebarContent = document.getElementById('sidebar-content');
            const categories = ['Tümü', 'Favorilerim', ...new Set(allChannels.map(c => getSafeCategory(c)))];
            
            sidebarContent.innerHTML = categories.map(cat => `
                <div class="p-2 mb-1 rounded cursor-pointer hover-bg d-flex align-items-center" onclick="filterByCategory('${cat}')">
                    <i class="fas ${cat === 'Favorilerim' ? 'fa-heart text-danger' : 'fa-chevron-right'} me-2 small"></i>
                    ${cat}
                </div>
            `).join('');
        }

        function filterByCategory(cat) {
            const title = document.getElementById('grid-title');
            title.innerText = cat;
            
            let filtered;
            if (cat === 'Tümü') filtered = allChannels;
            else if (cat === 'Favorilerim') filtered = allChannels.filter(c => favorites.includes(c.ad));
            else filtered = allChannels.filter(c => getSafeCategory(c) === cat);

            renderGrid(filtered);
            toggleSidebar();
            document.getElementById('player-box').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
        }

        // 8. Arama Motoru (Orijinal Arama Mantığı)
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allChannels.filter(c => 
                c.ad.toLowerCase().includes(term) || 
                getSafeCategory(c).toLowerCase().includes(term)
            );
            renderGrid(filtered);
            document.getElementById('grid-title').innerText = term ? `"${term}" için sonuçlar` : "Tüm Kanallar";
        });

        // 9. Tema & UI Kontrolleri
        function toggleTheme() {
            document.body.classList.toggle('normal-mode');
            const isNormal = document.body.classList.contains('normal-mode');
            document.getElementById('theme-meta').content = isNormal ? "#230c40" : "#000000";
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
        }

        function closePlayer() {
            document.getElementById('player-box').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('video').pause();
            window.location.hash = "";
        }

        function checkHash() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                const name = decodeURIComponent(hash);
                const channel = allChannels.find(c => c.ad === name);
                if (channel) playChannel(channel.url, channel.ad, true, getSafeCategory(channel));
            }
        }

        // 10. MutationObserver (Öne Çıkan Animasyonu)
        const observer = new MutationObserver(() => {
            const pCard = document.getElementById('featured-card');
            if (pCard) {
                pCard.classList.remove('promo-active');
                void pCard.offsetWidth;
                pCard.classList.add('promo-active');
            }
        });
        const target = document.getElementById('featured-area');
        if (target) observer.observe(target, { childList: true });

    </script>
    
    <script src="oneriler.js"></script>
</body>
</html>
