<!DOCTYPE html>
<html lang="tr">
<head>
    <meta id="theme-meta" name="theme-color" content="#230c40">
    <meta name="color-scheme" content="dark">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>orjnc tv+</title>
    <link rel="icon" type="image/png" href="logolar/logo.png">
    <link rel="apple-touch-icon" href="logolar/logo.png">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
   
:root {
    /* light dark yerine ONLY light yapıyoruz ki sistem karışmasın */
    color-scheme: only light; 
}
        
        
        /* 1. RENK DEĞİŞKENLERİ */
:root { 
    --bg: #000000; 
    --card: #121212; 
    --accent: #ff005c; 
    --text: #ffffff; 
    --gray: #888888; 
    --selected-cat: #F683BE; 
}

/* Sadece biz KOYU MODU seçtiğimizde butonlar siyah olsun */
body:not(.normal-mode) .cat-btn {
    background: #1a1a1a !important;
    border: 1px solid #333;
    backdrop-filter: none;
}
        
        
/* 2. NORMAL MOD (RENKLİ MOD) AYARLARI */
body.normal-mode {
    --bg: linear-gradient(135deg, #1a0b2e 0%, #4a148c 100%);
    --card: rgba(255, 255, 255, 0.1); 
    --text: #ffffff; 
    --gray: #cccccc;
}

/* 3. ANA GÖVDE AYARLARI */
html { 
    background-color: var(--bg); 
}

body { 
    background: var(--bg) !important; 
    background-attachment: fixed !important;
    background-size: cover !important;
    color: var(--text) !important; /* Yazıları değişkene bağladık ki okunsun */
/* --- KESİN ÇÖZÜM: GLASS SIDEBAR TASARIMI --- */


    min-height: 100vh;
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
}
/* 2. ADIM: METİN VE KART GÖRÜNÜMÜ SABİTLEME */

/* Tüm metin etiketlerini tek seferde temaya bağla */
.category-item, .channel-name, .sidebar h4, .nav-link, p, span, h1, h2, h3 {
    color: var(--text) !important;
    transition: color 0.3s ease;
}

/* Kategori listesindeki ikonlar için */
.category-item i {
    color: var(--text);
    opacity: 0.8;
}

/* Kanal kartlarının arka planı (Karanlıkta koyu, Normalde hafif şeffaf) */
.channel-card {
    background: var(--card) !important;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: transform 0.2s, background 0.3s;
}

        .sidebar { 
    position: fixed; 
    top: 75px !important; 
    bottom: 95px !important; 
    left: 50% !important; 
    /* Başlangıçta hafif aşağıda ve gizli */
    transform: translate(-50%, 30px) !important; 
    opacity: 0 !important; 
    visibility: hidden !important;
    
    width: 94% !important; 
    max-width: 500px;
    backdrop-filter: blur(30px) !important; 
    -webkit-backdrop-filter: blur(30px) !important;
    background: rgba(0, 0, 0, 0.7) !important; 
    border-radius: 30px !important; 
    padding: 25px !important; 
    z-index: 2500 !important; 
    display: flex; 
    flex-direction: column; 
    border: 1px solid rgba(255,255,255,0.1) !important;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    overflow-y: auto;
}

/* Tema Değiştirme Anahtarı Tasarımı */
.theme-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
}

.theme-switch input { 
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: #444;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

/* Açık olduğunda (Karanlık Mod aktif) */
input:checked + .slider {
    background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); /* Görseldeki gibi gradyan */
}

input:checked + .slider:before {
    transform: translateX(24px);
}
        
        
/* Sidebar Aktifleştiğinde (Açıldığında) */
.sidebar.active { 
    opacity: 1 !important; 
    visibility: visible !important; 
    transform: translate(-50%, 0) !important; 
}

/* Overlay Başlangıçta Gizli */
.overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    z-index: 2400;
    display: none; /* Başlangıçta kapalı */
}
        

.sidebar.active { 
    opacity: 1 !important;
    visibility: visible !important;
    transform: translate(-50%, 0) !important; 
}

/* Normal Mod: Şeffaf Mor Cam */
body.normal-mode .sidebar {
    background: rgba(255, 255, 255, 0.12) !important; 
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}

/* Koyu Mod: Şeffaf Siyah Cam */
body:not(.normal-mode) .sidebar {
    background: rgba(0, 0, 0, 0.7) !important; 
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
}

.menu-item { 
    display: flex; 
    align-items: center; 
    gap: 15px; 
    padding: 18px; 
    color: #ffffff !important; 
    background: rgba(255, 255, 255, 0.05);
    border-radius: 18px; 
    margin-bottom: 8px; 
    text-decoration: none;
}

.overlay {
    z-index: 2400 !important;
    background: rgba(0,0,0,0.2) !important;
    backdrop-filter: blur(3px);
}
        

        /* Kategori Butonları */
        .category-container { display: flex; gap: 10px; overflow-x: auto; padding: 15px 15px 20px 15px; white-space: nowrap; scrollbar-width: none; min-height: 75px; transition: all 0.6s ease; }
        /* Kategori Butonları */
.cat-btn { 
    background: rgba(255, 255, 255, 0.1) !important; /* Normal Mod: Şeffaf beyaz */
    color: #ffffff; 
    border: 1px solid rgba(255, 255, 255, 0.15); 
    padding: 10px 22px !important; 
    border-radius: 100px !important; 
    font-size: 0.85rem; 
    font-weight: 600; 
    cursor: pointer; 
    transition: all 0.5s ease; 
    flex-shrink: 0; 
    backdrop-filter: blur(10px); /* Toz bulutu efekti */
    -webkit-backdrop-filter: blur(10px);
}


         /* Ekranın ortasındaki gereksiz eski ikonları ve yazıları gizler */
#home-section > i, 
#home-section > small, 
#home-section > br,
#main-content > i,
#main-content > small,
center {
    display: none !important;
}

/* Arama sayfasındaki benzer fazlalıkları da temizler */
#search-section > i,
#search-section > small,
#search-section > br {
    display: none !important;
}
        
        .cat-btn.active { background: var(--selected-cat) !important; color: white; border-color: var(--selected-cat); }
        .cat-hidden { display: none; }

        .header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 10px 20px; 
    position: sticky; 
    top: 0; 
    height: 70px; 
    /* Z-INDEX 4000 YAPTIK: Videonun (1100) üstüne çıktı, Sidebar'ın (3000) da üstüne çıktı. */
    z-index: 4000; 

    /* SENİN ORİJİNAL EFEKTLERİN (AYNEN KORUNDU) */
    backdrop-filter: blur(15px); 
    -webkit-backdrop-filter: blur(15px); 
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);

    /* 1. NORMAL MOD: Senin Mor Rengin */
    background: rgba(37, 12, 68, 0.7) !important; 
}
        
        
        .logo-container { flex: 1; display: flex; justify-content: center; align-items: center; }
        .site-logo { max-height: 48px; width: auto; object-fit: contain; cursor: pointer; }
        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0 15px; }
        .channel-square { 
    /* SENİN ORİJİNAL YAPIN */
    border-radius: 18px; 
    aspect-ratio: 1/1; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    position: relative; 
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.15);
    transition: all 0.3s ease;

    /* NORMAL MOD: TOZ BULUTU / CAM EFEKTİ */
    background: rgba(255, 255, 255, 0.1) !important; 
    backdrop-filter: blur(10px); 
    -webkit-backdrop-filter: blur(10px);
}

        
        .square-logo { width: 70%; height: 70%; object-fit: contain; }
        .fav-star { position: absolute; top: 10px; right: 10px; font-size: 0.8rem; color: rgba(255,255,255,0.2); z-index: 5; }
        .fav-star.active { color: #ffc107; }

        /* Player */
        #player-box { display: none; background: #000; }
        .video-wrapper { position: relative; top: 0; z-index: 900 !important; background: #000; }
        video { width: 100%; aspect-ratio: 16/9; }
        .player-info-sticky { padding: 15px 20px; border-bottom: 2px solid #222; }

/* Header - Buzlu Cam Efekti */
.header {
    backdrop-filter: blur(15px); 
    -webkit-backdrop-filter: blur(15px);
    transition: all 0.4s ease;
}

/* NORMAL MODDA Header */
body.normal-mode .header {
    background: rgba(35, 12, 64, 0.7) !important; /* Mor şeffaf */
}

body:not(.normal-mode) .header {
    background: rgba(0, 0, 0, 0.7) !important;
    backdrop-filter: blur(15px) !important;
}
        
        
        /* Navigasyon - Buzlu Cam Efekti */
.bottom-nav { 
    position: fixed; 
    bottom: 15px; 
    left: 50%; 
    transform: translateX(-50%); 
    width: 92%; 
    border-radius: 25px; 
    display: flex; 
    justify-content: space-around; 
    padding: 12px; 
    z-index: 2500; 
    transition: all 0.4s ease;

    /* Ortak Buzlu Cam Ayarları */
    backdrop-filter: blur(15px); 
    -webkit-backdrop-filter: blur(15px); 
}

/* NORMAL MODDA: Mor/Beyazımsı Cam */
body.normal-mode .bottom-nav {
    background: rgba(255, 255, 255, 0.1) !important; 
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
}

/* KOYU MODDA: Siyah Cam (Blur Efektli) */
body:not(.normal-mode) .bottom-nav {
    background: rgba(0, 0, 0, 0.7) !important; /* Tam siyah değil, %70 şeffaf siyah */
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
}

        .nav-btn { color: #666; font-size: 1.2rem; display: flex; flex-direction: column; align-items: center; text-decoration: none; cursor: pointer; }
        .nav-btn.active { color: var(--accent); }
        .nav-btn small { font-size: 0.6rem; margin-top: 4px; font-weight: bold; }
        
        #main-content { padding-bottom: 120px; }
        .overlay { 
    display:none; 
    position: fixed; 
    inset: 0; 
    background: rgba(0,0,0,0.8); 
    /* Header (2000) ile Sidebar (3000) arasında kalmalı */
    z-index: 2500 !important; 
        }
        
        #search-section { padding: 15px; display: none; }
        .search-input { background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 15px; padding: 12px 20px; width: 100%; margin-bottom: 20px; }
        .list-item { background: var(--card); border-radius: 15px; padding: 15px; display: flex; align-items: center; gap: 15px; margin-bottom: 12px; border: 1px solid #222; cursor: pointer; }
        .list-logo { width: 55px; height: 55px; object-fit: contain; }

        /* Promo Card */
        .promo-slider { padding: 0 15px; margin-bottom: 30px; transition: 0.5s; }
        .promo-card { 
    aspect-ratio: 3/4; 
    width: 100%; 
    max-width: 400px; 
    margin: 0 auto; 
    border-radius: 25px; 
    display: flex; 
    align-items: flex-end; 
    padding: 25px; 
    border: 1px solid rgba(255,255,255,0.1); 
    background-size: cover; 
    background-position: center; 
    position: relative; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    /* EKLEDİĞİMİZ KISIM: */
    transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.5s ease;
    overflow: hidden;
}

/* Geçiş anında devreye girecek yeni sınıf */
/* Mevcut olanı bununla değiştir veya kontrol et */
.promo-active {
    animation: promoSwift 0.7s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}
        @keyframes promoSwift {
    0% { 
        opacity: 0; 
        transform: scale(0.95) translateY(5px); 
        filter: blur(5px); 
    }
    100% { 
        opacity: 1; 
        transform: scale(1) translateY(0); 
        filter: blur(0); 
    }
        }
         
        .promo-card > div { position: relative; z-index: 2; width: 100%; }
        .promo-hidden { display: none !important; }
        /* Player açıkken en alttaki kanalın rahat görünmesi için boşluk */
#player-box {
    padding-bottom: 120px !important;
    min-height: 100vh;
}

        /* Tıklanan (aktif olan) butonun ikon ve metin rengini beyaz yapar */
.nav-btn.active, 
.nav-btn.active i, 
.nav-btn.active small { 
    color: #ffffff !important; 
    opacity: 1 !important;
}
        /* SADECE OYNATICI SAYFASI İÇİN ÖZEL İYİLEŞTİRMELER */

/* 1. Normal Modda Player Arka Planını Mor Temaya Bağla */
body.normal-mode #player-box { 
    background: linear-gradient(135deg, #1a0b2e 0%, #4a148c 100%) !important; 
}

/* 2. Video ve Başlık Alanını Sabitle (Sticky) */
.video-wrapper {
    position: sticky !important;
    top: 0;
    z-index: 2200;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
}

.player-info-sticky {
    position: sticky !important;
    top: 0; /* Mobilde video hemen üstte olduğu için 0 idealdir */
    z-index: 2100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.6) !important;
}

/* Normal modda başlık alanını mor cam yap */
body.normal-mode .player-info-sticky {
    background: rgba(35, 12, 64, 0.7) !important;
}

/* KOYU MOD ÖZEL: Player Başlık Alanı (Siyah Cam Efekti) */
body:not(.normal-mode) .player-info-sticky {
    /* Mor arka planı tamamen iptal edip şeffaf siyah yapıyoruz */
    background: rgba(0, 0, 0, 0.6) !important; 
    
    /* Buzlu cam efekti */
    backdrop-filter: blur(20px) !important;
    -webkit-backdrop-filter: blur(20px) !important;
    
    /* Üst ve alt sınır çizgilerini belirginleştirerek derinlik katıyoruz */
    border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.05) !important;
}

/* Koyu modda kanal ismi ve altındaki yazıların rengini garantiye alalım */
body:not(.normal-mode) #now-playing, 
body:not(.normal-mode) #player-cat-info {
    color: #ffffff !important;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5); /* Yazı okunabilirliği için hafif gölge */
}
        

        
/* 3. Önerilen Kanal Kartlarını Cam Efektli Yap (Glassmorphism) */
#suggested-list .list-item {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 15px;
    margin-bottom: 10px;
}

/* 4. Kaydırma Alanı İçin Alt Boşluk */
#player-box {
    padding-bottom: 150px !important;
}
       /* PLAYER SAYFASI KAYMA VE ÜST ÜSTE BİNME DÜZELTMESİ */

/* 1. Video alanının en üstte ve sabit kalmasını sağla */
.video-wrapper {
    position: sticky !important;
    top: 70px !important; /* Header (70px) yüksekliği kadar aşağıdan başlar */
    z-index: 2000 !important; /* Videoyu sağlam bir katmana al */
    background: #000;
}

/* 2. Kanal isminin videonun üzerine binmesini engelle */
.player-info-sticky {
    position: sticky !important;
    /* ÖNEMLİ: Videonun yüksekliği (16:9 oranında ekran genişliği) + Header kadar pay bırakır */
    top: calc(70px + (100vw * 9 / 16)) !important; 
    z-index: 1500 !important; /* Videonun (2000) bir tık altında kalsın */
    background: rgba(35, 12, 64, 0.9) !important; /* Arkasını göstermeyen cam efekti */
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
}

/* 3. Header'ın her zaman en üstte (logonun görünür) kalmasını garanti et */
.header {
    z-index: 3000 !important;
    position: sticky !important;
    top: 0 !important;
}

        /* DOĞRU HEDEF: Player Altındaki Kanal Başlık Alanı */
body:not(.normal-mode) #video-title-container {
    background: rgba(0, 0, 0, 0.8) !important; /* İnatçı moru siyaha çevirir */
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
}

        /* KOYU MOD: Seçili olan kategoriyi belirginleştirme */
body:not(.normal-mode) .cat-btn.active {
    /* Bulanık beyaz-gri cam efekti */
    background: rgba(255, 255, 255, 0.25) !important; 
    color: #ffffff !important;
    border: 1px solid rgba(255, 255, 255, 0.4) !important;
    
    /* Parlama ve vurgu efekti */
    box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    
    /* Pembe rengi Koyu Modda devre dışı bırakıyoruz */
    --selected-cat: transparent; 
}

/* KOYU MOD: Diğer butonları biraz daha sade tutma */
body:not(.normal-mode) .cat-btn:not(.active) {
    background: rgba(255, 255, 255, 0.08) !important;
    color: rgba(255, 255, 255, 0.7) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}
        
        
    </style>
</head>
<body> 


        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <div class="sidebar" id="sidebar">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <img src="logolar/logo.png" alt="orjnc tv+" class="sidebar-logo" style="max-height: 30px; width: auto;">
            <div onclick="toggleSidebar()" style="cursor: pointer; opacity: 0.8;">
                <i class="fas fa-times fs-4 text-white"></i>
            </div>
        </div>
        
        <div class="menu-links" style="overflow-y: auto; flex: 1;">
            
                <i class="fas fa-star"></i> <span>Favorilerim</span>
            </div>
            <div class="menu-item d-flex justify-content-between align-items-center" style="cursor: default;">
    <div class="d-flex align-items-center gap-3">
        <i class="fas fa-moon"></i> 
        <span>Karanlık Mod</span>
    </div>
    <label class="theme-switch">
        <input type="checkbox" id="darkModeToggle" onchange="toggleThemeAction()">
        <span class="slider"></span>
    </label>
            </div>
        
            <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 5px;">
            <div onclick="setTheme('dark'); toggleSidebar();" class="menu-item">
            <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 5px;">
            <div class="menu-item" style="background: none; border: none; opacity: 0.5; cursor: default;">
                <i class="fas fa-code-branch"></i> 
                <span>Sürüm 1.0.8</span> 
            </div>
        </div>
    </div>

    <div class="header">
        <i class="fas fa-bars fs-4" onclick="toggleSidebar()"></i>
        <div class="logo-container">
            <a href="javascript:void(0)" onclick="showHome()">
                <img src="logolar/logo.png" alt="orjnc tv+" class="site-logo">
            </a>
        </div>
        <i class="fas fa-tv fs-4" style="color: var(--accent);"></i>
    </div>

    <div id="player-box">
        <div class="video-wrapper">
            <video id="video" controls autoplay playsinline></video>
        </div>
        <div class="player-info-sticky" id="video-title-container">
            <h5 id="now-playing" class="m-0 text-truncate">Kanal Adı</h5>
            <p class="small mt-1 mb-0" id="player-cat-info">Canlı Yayın</p>
        </div>
        <div class="p-3">
            <div id="suggested-list"></div>
        </div>
    </div>

    <div id="main-content">
        <div class="category-container" id="category-list"></div>

        <div class="promo-slider" id="promo-slider">
            <div class="promo-card" id="featured-card" onclick="playFeatured()" style="cursor: pointer;">
                <div>
                    <h3 class="m-0" id="featured-title" style="font-weight: 800;">Yükleniyor...</h3>
                    <div class="d-flex gap-2 mt-2 align-items-center">
                        <span class="badge bg-danger">LIVE</span>
                        <span id="featured-desc" class="small">Lütfen bekleyin...</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="search-section" style="display: none;">
            <input type="text" id="searchInput" class="search-input" placeholder="Kanal ara..." onkeyup="doSearch()">
            <div id="search-results"></div>
        </div>

        <div id="home-section">
            <div class="px-3 mb-3"><span style="font-weight:bold;">TV Channels</span></div>
            <div id="grid-container" class="grid-container"></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div onclick="showHome()" class="nav-btn active" id="btn-home">
            <i class="fas fa-house"></i>
            <small>ANASAYFA</small>
        </div>
        
        <div onclick="showSearch()" class="nav-btn" id="btn-search">
            <i class="fas fa-search"></i>
            <small>ARA</small>
        </div>
        
        <div onclick="showFavorites()" class="nav-btn" id="btn-fav">
            <i class="fas fa-heart"></i>
            <small>FAVORİLER</small>
        </div>
        
        <div onclick="toggleSidebar()" class="nav-btn">
            <i class="fas fa-bars"></i>
            <small>DAHA FAZLA</small>
        </div>
    </div>
        
         <script>

            
    if (mode === 'normal') { 
        body.classList.add('normal-mode'); 
        localStorage.setItem('themeChoice', 'normal');
        
        // NORMAL MOD: Senin belirlediğin mor tonu (#230c40)
        if(themeMeta) themeMeta.setAttribute('content', '#230c40'); 
        
        body.style.color = '#ffffff';
    } 
    else { 
        body.classList.remove('normal-mode'); 
        localStorage.setItem('themeChoice', 'dark');
        
        // KOYU MOD: Adres çubuğu dahil her yer ZİFİRİ SİYAH (#000000)
        if(themeMeta) themeMeta.setAttribute('content', '#000000'); 
        
        body.style.color = '#ffffff';
    }
             }
             

             
        function renderCategories(data) {
            const catContainer = document.getElementById('category-list');
            const categories = ['Tümü', ...new Set(data.map(k => getSafeCategory(k)))];
            catContainer.innerHTML = '';
            categories.forEach(cat => {
                const isAll = cat === 'Tümü';
                catContainer.innerHTML += `<button class="cat-btn ${isAll ? 'active' : ''}" onclick="${isAll ? 'renderGrid(allChannels, this)' : `filterCategory('${cat}', this)`}">${cat}</button>`;
            });
        }

        function renderGrid(data, btn) {
            if(btn) {
                document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                if(btn.innerText === 'Tümü') document.getElementById('promo-slider').classList.remove('promo-hidden');
            }
            const container = document.getElementById('grid-container');
            container.innerHTML = "";
            data.forEach(k => {
                const isFav = favorites.includes(k.ad) ? 'active' : '';
                container.innerHTML += `
                    <div class="channel-square">
                        <i class="fas fa-star fav-star ${isFav}" onclick="toggleFav(event, '${k.ad}')"></i>
                        <div class="w-100 h-100 d-flex align-items-center justify-content-center" onclick="playChannel('${k.url}', '${k.ad}', false, '${getSafeCategory(k)}')">
                            <img src="${getSafeLogo(k)}" class="square-logo" onerror="this.src='logolar/default.png'">
                        </div>
                    </div>`;
            });
        }

        <script>
    // --- TEMEL DEĞİŞKENLER ---
    let allChannels = [];
    let favorites = JSON.parse(localStorage.getItem('myTVfavs')) || [];
    const hls = new Hls();
    const video = document.getElementById('video');

    // --- 1. SAYFA YÜKLENDİĞİNDE ÇALIŞACAK ANA BLOK ---
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('themeChoice');
        const toggle = document.getElementById('darkModeToggle');
        
        // Tema ve Switch Ayarı
        if (savedTheme === 'dark') {
            setTheme('dark');
            if (toggle) toggle.checked = true;
        } else {
            setTheme('normal');
            if (toggle) toggle.checked = false;
        }

        // Kanal Verilerini Yükleme
        fetch('kanallar.json?v=' + Date.now())
            .then(res => res.json())
            .then(data => { 
                allChannels = data; 
                renderCategories(data); 
                renderGrid(data); 
                checkHash(); 
            })
            .catch(err => console.error("Kanal yükleme hatası:", err));
    });

    // --- 2. TEMA VE SIDEBAR FONKSİYONLARI ---
    function setTheme(mode) {
        const body = document.body;
        const themeMeta = document.getElementById('theme-meta');
        if (mode === 'normal') { 
            body.classList.add('normal-mode'); 
            localStorage.setItem('themeChoice', 'normal');
            if(themeMeta) themeMeta.setAttribute('content', '#230c40'); 
        } else { 
            body.classList.remove('normal-mode'); 
            localStorage.setItem('themeChoice', 'dark');
            if(themeMeta) themeMeta.setAttribute('content', '#000000'); 
        }
    }

    function toggleThemeAction() {
        const toggle = document.getElementById('darkModeToggle');
        if (toggle && toggle.checked) { setTheme('dark'); } 
        else { setTheme('normal'); }
    }

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        sidebar.classList.toggle('active');
        overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
    }

    // --- 3. NAVİGASYON VE GÖRÜNÜM FONKSİYONLARI ---
    function updateNavActive(id) {
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        const target = document.getElementById(id);
        if(target) target.classList.add('active');
    }

    function showHome() {
        document.getElementById('player-box').style.display = "none";
        document.getElementById('main-content').style.display = "block";
        document.getElementById('home-section').style.display = "block";
        document.getElementById('search-section').style.display = "none";
        document.getElementById('category-list').style.display = "flex";
        document.getElementById('promo-slider').classList.remove('promo-hidden');
        if (video) { video.pause(); video.src = ""; }
        if (hls) { hls.detachMedia(); hls.stopLoad(); }
        updateNavActive('btn-home');
        renderGrid(allChannels);
        history.pushState("", document.title, window.location.pathname);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showSearch() {
        document.getElementById('player-box').style.display = "none";
        document.getElementById('home-section').style.display = "none";
        document.getElementById('category-list').style.display = "none";
        document.getElementById('promo-slider').style.display = "none";
        document.getElementById('search-section').style.display = "block";
        updateNavActive('btn-search');
        setTimeout(() => { document.getElementById('searchInput')?.focus(); }, 300);
    }

    function showFavorites() {
        const favChannels = allChannels.filter(k => favorites.includes(k.ad));
        document.getElementById('player-box').style.display = "none";
        document.getElementById('search-section').style.display = "none";
        document.getElementById('home-section').style.display = "block";
        document.getElementById('category-list').style.display = "none";
        document.getElementById('promo-slider').style.display = "none";
        renderGrid(favChannels);
        updateNavActive('btn-fav');
    }

    // --- 4. VERİ İŞLEME VE OYNATICI ---
    function getSafeLogo(k) {
        if (!k.logo) return 'logolar/default.png';
        let filename = k.logo.split('/').pop().replace(/\.(jpg|jpeg|png|gif|webp)$/i, '');
        return 'logolar/' + filename.toLowerCase() + '.png';
    }

    function getSafeCategory(k) {
        return k.kategori || "Genel";
    }

    function renderCategories(data) {
        const catContainer = document.getElementById('category-list');
        const categories = ['Tümü', ...new Set(data.map(k => getSafeCategory(k)))];
        catContainer.innerHTML = categories.map(cat => {
            const isAll = cat === 'Tümü';
            return `<button class="cat-btn ${isAll ? 'active' : ''}" onclick="${isAll ? 'renderGrid(allChannels, this)' : `filterCategory('${cat}', this)`}">${cat}</button>`;
        }).join('');
    }

    function renderGrid(data, btn) {
        if(btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(btn.innerText === 'Tümü') document.getElementById('promo-slider').classList.remove('promo-hidden');
        }
        const container = document.getElementById('grid-container');
        container.innerHTML = data.map(k => `
            <div class="channel-square">
                <i class="fas fa-star fav-star ${favorites.includes(k.ad) ? 'active' : ''}" onclick="toggleFav(event, '${k.ad}')"></i>
                <div class="w-100 h-100 d-flex align-items-center justify-content-center" onclick="playChannel('${k.url}', '${k.ad}', false, '${getSafeCategory(k)}')">
                    <img src="${getSafeLogo(k)}" class="square-logo" onerror="this.src='logolar/default.png'">
                </div>
            </div>`).join('');
    }

    function playChannel(url, ad, fromHash = false, kategori = "Genel") {
        if(!fromHash) history.pushState({page: 'player'}, ad, "#" + encodeURIComponent(ad));
        document.getElementById('player-box').style.display = "block";
        document.getElementById('main-content').style.display = "none";
        document.getElementById('now-playing').innerText = ad;
        document.getElementById('player-cat-info').innerText = "Canlı Yayın • " + kategori;
        window.scrollTo(0,0);
        if (Hls.isSupported()) { hls.loadSource(url); hls.attachMedia(video); hls.on(Hls.Events.MANIFEST_PARSED, () => video.play()); }
        else if (video.canPlayType('application/vnd.apple.mpegurl')) { video.src = url; video.play(); }
    }

    function doSearch() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const res = allChannels.filter(k => k.ad.toLowerCase().includes(q));
        const container = document.getElementById('search-results');
        container.innerHTML = res.map(k => `
            <div class="list-item" onclick="playChannel('${k.url}', '${k.ad}', false, '${getSafeCategory(k)}')">
                <img src="${getSafeLogo(k)}" class="list-logo" onerror="this.src='logolar/default.png'">
                <div class="list-info"><strong>${k.ad}</strong><div class="small text-muted">${getSafeCategory(k)}</div></div>
            </div>`).join('');
    }

    function toggleFav(e, name) {
        e.stopPropagation();
        const idx = favorites.indexOf(name);
        if (idx > -1) favorites.splice(idx, 1); else favorites.push(name);
        localStorage.setItem('myTVfavs', JSON.stringify(favorites));
        renderGrid(allChannels);
    }

    function checkHash() {
        const h = window.location.hash.substring(1);
        if(h) { 
            const decodedName = decodeURIComponent(h);
            const c = allChannels.find(k => k.ad === decodedName); 
            if(c) playChannel(c.url, c.ad, true, getSafeCategory(c)); 
        }
    }

    window.onpopstate = () => showHome();
</script>

<script>
    // Promo Animasyon Sistemi
    const observer = new MutationObserver(() => {
        const pCard = document.getElementById('featured-card');
        if (pCard) {
            pCard.classList.remove('promo-active');
            void pCard.offsetWidth;
            pCard.classList.add('promo-active');
        }
    });
    const targetNode = document.getElementById('featured-card');
    if (targetNode) observer.observe(targetNode, { attributes: true, childList: true, subtree: true });
</script>
    <script src="oneriler.js"></script>

<script>
// Animasyonu tetikleyen sistem
const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
        if (mutation.type === "childList" || mutation.attributeName === "style") {
            const pCard = document.getElementById('featured-card');
            if (pCard) {
                pCard.classList.remove('promo-active');
                void pCard.offsetWidth; // Reflow tetikleyici
                pCard.classList.add('promo-active');
            }
        }
    });
});
const targetNode = document.getElementById('featured-card');
if (targetNode) {
    observer.observe(targetNode, { attributes: true, childList: true, subtree: true });
}
</script>

</body>
</html>
        
